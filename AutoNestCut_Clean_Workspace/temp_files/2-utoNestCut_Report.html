<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoNestCut Interactive Report</title>
    <style>body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0px; padding: 0px; background: rgb(255, 255, 255); display: flex; flex-direction: column; height: 100vh; font-size: 14px; color: rgb(0, 0, 0); font-weight: 700; }
.header { background: rgb(255, 255, 255); border-bottom: 1px solid rgb(208, 215, 222); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; height: 56px; flex-shrink: 0; }
.header-controls { display: flex; align-items: center; gap: 16px; }
.language-selector { display: flex; align-items: center; gap: 8px; }
.language-selector select { padding: 6px 8px; border: 1px solid rgb(208, 215, 222); border-radius: 4px; font-size: 14px; background: rgb(255, 255, 255); color: rgb(26, 26, 26); font-weight: 500; }
.settings-btn { background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); padding: 8px; border-radius: 4px; cursor: pointer; transition: 0.15s; margin-right: 16px; }
.settings-btn:hover { background: rgb(246, 248, 250); border-color: rgb(140, 149, 159); }
.settings-btn svg { stroke: rgb(36, 41, 46); }
.settings-section { margin-bottom: 20px; }
.settings-section h3 { margin: 0px 0px 8px; font-size: 14px; font-weight: 700; color: rgb(0, 0, 0); }
.settings-buttons { display: flex; gap: 8px; justify-content: flex-end; margin-top: 24px; }
.header-content h1 { margin: 0px; font-size: 18px; font-weight: 900; color: rgb(0, 0, 0); }
.developer-credit { margin: 2px 0px 0px; font-size: 12px; color: rgb(74, 74, 74); font-weight: 500; }
.tabs { display: flex; gap: 4px; background: rgb(246, 248, 250); padding: 4px; border-radius: 6px; }
.tab-button { background: transparent; border: none; padding: 8px 16px; border-radius: 4px; font-size: 14px; color: rgb(101, 109, 118); cursor: pointer; transition: 0.15s; }
.tab-button:hover { background: rgb(255, 255, 255); color: rgb(36, 41, 46); }
.tab-button.active { background: rgb(255, 255, 255); color: rgb(36, 41, 46); box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 3px; }
.tab-button:disabled { opacity: 0.5; cursor: not-allowed; }
.tab-content { display: none; flex: 1 1 0%; overflow: hidden; }
.tab-content.active { display: flex; flex-direction: column; }
.config-container { max-width: 900px; margin: 0px auto; padding: 24px; overflow-y: auto; flex: 1 1 0%; }
.report-header { background: rgb(255, 255, 255); border-bottom: 1px solid rgb(208, 215, 222); padding: 12px 20px; display: flex; gap: 12px; align-items: center; flex-shrink: 0; }
.export-btn { display: flex; align-items: center; gap: 6px; background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); padding: 8px 12px; border-radius: 6px; font-size: 14px; color: rgb(36, 41, 46); cursor: pointer; transition: 0.15s; }
.export-btn:hover { background: rgb(246, 248, 250); border-color: rgb(140, 149, 159); }
.export-icon { width: 16px; height: 16px; }
h2 { font-size: 16px; font-weight: 900; color: rgb(0, 0, 0); margin: 24px 0px 12px; padding-bottom: 6px; border-bottom: none; }
.section { margin-bottom: 24px; }
.form-group { margin-bottom: 12px; }
label { display: block; font-size: 14px; font-weight: 800; color: rgb(0, 0, 0); margin-bottom: 6px; }
input[type="number"], input[type="text"], input[type="date"] { width: 100%; padding: 8px 12px; border: 1px solid rgb(208, 215, 222); border-radius: 6px; font-size: 14px; box-sizing: border-box; }
input:focus { outline: none; border-color: rgb(36, 41, 46); box-shadow: rgba(36, 41, 46, 0.1) 0px 0px 0px 3px; }
.materials-controls-group { display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px; }
.materials-action-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
.material-icon-btn { display: flex; align-items: center; gap: 6px; background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); padding: 8px 12px; border-radius: 6px; font-size: 14px; color: rgb(36, 41, 46); cursor: pointer; transition: 0.15s; }
.material-icon-btn:hover { background: rgb(246, 248, 250); border-color: rgb(140, 149, 159); }
.material-icon { width: 16px; height: 16px; }
.materials-header { display: grid; grid-template-columns: 1fr 120px 120px 120px 100px 100px auto auto; gap: 12px; padding: 8px 12px; background: rgb(245, 245, 245); border-radius: 6px; font-size: 14px; font-weight: 900; color: rgb(0, 0, 0); margin-bottom: 8px; }
.material-item { display: grid; grid-template-columns: 1fr 120px 120px 120px 100px 100px auto auto; gap: 12px; padding: 8px 12px; border-radius: 6px; align-items: center; margin-bottom: 4px; border: 1px solid transparent; }
.material-used { background: rgb(245, 245, 245); border-color: rgb(208, 208, 208); }
.material-unused { background: rgb(255, 255, 255); border-color: rgb(208, 215, 222); }
.material-item input { padding: 6px 8px; border: 1px solid rgb(208, 215, 222); border-radius: 4px; font-size: 14px; }
.material-actions { display: flex; gap: 4px; }
.material-action-btn { background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; }
.material-action-btn:hover { background: rgb(246, 248, 250); }
.buttons-top { text-align: center; margin-bottom: 24px; padding: 16px; background: rgb(246, 248, 250); border-radius: 6px; border: 1px solid rgb(208, 215, 222); }
button { padding: 10px 16px; margin: 0px 6px; border: 1px solid rgb(208, 215, 222); border-radius: 6px; font-size: 14px; background: rgb(255, 255, 255); color: rgb(36, 41, 46); cursor: pointer; transition: 0.15s; }
button:hover { background: rgb(246, 248, 250); border-color: rgb(140, 149, 159); }
button.primary { background: rgb(36, 41, 46); color: white; border-color: rgb(36, 41, 46); }
button.primary:hover { background: rgb(28, 33, 40); }
button.secondary { background: rgb(101, 109, 118); color: white; border-color: rgb(101, 109, 118); }
button.secondary:hover { background: rgb(76, 85, 97); }
.table-wrapper { overflow: auto visible; margin-bottom: 16px; border: 1px solid rgb(208, 215, 222); border-radius: 6px; max-width: 100%; min-width: 0px; width: 100%; display: block; white-space: nowrap; }
table { width: 100%; min-width: 700px; border-collapse: collapse; font-size: 14px; background: rgb(255, 255, 255); margin: 0px; }
th, td { padding: 8px 12px; text-align: left; border-bottom: 1px solid rgb(208, 215, 222); white-space: nowrap; }
th { position: sticky; top: 0px; z-index: 10; background: rgb(245, 245, 245); font-weight: 900; font-size: 14px; color: rgb(0, 0, 0); }
td[title] { white-space: normal; overflow-wrap: break-word; max-width: 150px; }
@media (max-width: 768px) {
  .table-wrapper { font-size: 12px; }
  th, td { padding: 6px 8px; max-width: 120px; }
}
tbody tr:hover { background: rgb(246, 248, 250); }
.container { display: flex; flex: 1 1 0%; overflow: hidden; }
.diagrams-container { flex: 1 1 0%; min-width: 300px; padding: 16px; background: rgb(255, 255, 255); border-right: 1px solid rgb(208, 215, 222); overflow-y: auto; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 16px; }
.report-container { flex: 1 1 0%; padding: 16px; background: rgb(255, 255, 255); overflow: hidden auto; min-width: 0px; }
#resizer { width: 8px; background: rgb(208, 215, 222); cursor: col-resize; user-select: none; flex-shrink: 0; transition: background 0.2s; border-left: 1px solid rgb(208, 215, 222); border-right: 1px solid rgb(208, 215, 222); }
#resizer:hover { background: rgb(140, 149, 159); }
#resizer:active { background: rgb(101, 109, 118); }
.project-info { background: rgb(246, 248, 250); padding: 16px; border-radius: 6px; border: 1px solid rgb(208, 215, 222); margin: 16px 0px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
.project-field { display: flex; flex-direction: column; }
.project-field input { padding: 8px 12px; border: 1px solid rgb(208, 215, 222); border-radius: 6px; font-size: 14px; }
.project-field input:focus { outline: none; border-color: rgb(36, 41, 46); box-shadow: rgba(36, 41, 46, 0.1) 0px 0px 0px 3px; }
.tree-controls { margin: 12px 0px; }
.tree-search { display: flex; gap: 8px; align-items: center; padding: 12px; background: rgb(246, 248, 250); border-radius: 6px; border: 1px solid rgb(208, 215, 222); }
.tree-search input { flex: 1 1 0%; padding: 6px 10px; border: 1px solid rgb(208, 215, 222); border-radius: 4px; font-size: 14px; }
.tree-search button { padding: 6px 12px; font-size: 14px; margin: 0px; }
.parts-card { margin-bottom: 16px; border: 1px solid rgb(208, 215, 222); border-radius: 6px; background: rgb(255, 255, 255); }
.parts-card-title { background: rgb(245, 245, 245); padding: 8px 12px; font-weight: 900; font-size: 14px; border-bottom: 1px solid rgb(208, 215, 222); color: rgb(0, 0, 0); }
.parts-preview-table th, .parts-preview-table td { padding: 6px 8px; font-size: 14px; }
.used-indicator { color: rgb(0, 0, 0); font-weight: 800; font-size: 12px; }
.unused-indicator { color: rgb(101, 109, 118); font-size: 12px; }
.sort-select { padding: 6px 8px; border: 1px solid rgb(208, 215, 222); border-radius: 4px; font-size: 14px; background: rgb(255, 255, 255); }
.materials-sort-controls, .materials-filter-buttons, .currency-selector { display: flex; gap: 8px; align-items: center; }
.currency-selector { margin-bottom: 12px; }
.currency-selector label { margin-bottom: 0px; font-weight: 600; color: rgb(26, 26, 26); }
.tree-structure { background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); border-radius: 6px; padding: 16px; margin: 12px 0px; max-height: 500px; overflow-y: auto; font-size: 14px; }
.modal { display: none; position: fixed; z-index: 1000; left: 0px; top: 0px; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); }
.modal-content { background: rgb(255, 255, 255); margin: 5% auto; padding: 20px; border: 1px solid rgb(208, 215, 222); width: 520px; max-width: 90%; border-radius: 6px; }
.close { color: rgb(101, 109, 118); float: right; font-size: 24px; font-weight: bold; cursor: pointer; }
.close:hover { color: rgb(36, 41, 46); }
body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0px; padding: 0px; background: rgb(255, 255, 255); display: flex; flex-direction: column; height: 100vh; font-size: 14px; color: rgb(36, 41, 46); }
.header { background: rgb(255, 255, 255); border-bottom: 1px solid rgb(208, 215, 222); padding: 12px 20px; display: flex; justify-content: space-between; align-items: center; height: 56px; }
.header h1 { font-size: 18px; margin: 0px; font-weight: 600; color: rgb(36, 41, 46); }
.developer-credit { font-size: 12px; margin: 2px 0px 0px; color: rgb(101, 109, 118); }
.back-btn, .icon-btn { background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); padding: 8px 12px; border-radius: 6px; font-size: 14px; color: rgb(36, 41, 46); cursor: pointer; transition: 0.15s; }
.back-btn:hover, .icon-btn:hover { background: rgb(246, 248, 250); border-color: rgb(140, 149, 159); }
.icon-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; min-width: 60px; padding: 8px 10px; }
.icon-btn .icon { font-size: 16px; }
.icon-btn .label { font-size: 11px; }
button { background: rgb(36, 41, 46); color: white; border: none; padding: 10px 16px; border-radius: 6px; font-size: 14px; cursor: pointer; transition: 0.15s; }
button:hover { background: rgb(28, 33, 40); }
.btn-secondary { background: rgb(255, 255, 255); color: rgb(36, 41, 46); border: 1px solid rgb(208, 215, 222); }
.btn-secondary:hover { background: rgb(246, 248, 250); }
.container { display: flex; flex: 1 1 0%; overflow: visible; }
.diagrams-container { flex: 1 0 auto; min-width: 300px; padding: 16px; background: rgb(255, 255, 255); border-right: 1px solid rgb(208, 215, 222); overflow: hidden auto; display: block; }
.report-container { flex: 1 0 auto; min-width: 400px; padding: 16px; background: rgb(255, 255, 255); overflow: auto; }
#resizer { width: 5px; flex-shrink: 0; background: rgb(208, 215, 222); cursor: col-resize; user-select: none; z-index: 10; }
#resizer:hover { background: rgb(36, 41, 46); }
.diagram-card { border: 1px solid rgb(208, 215, 222); padding: 12px; background: rgb(255, 255, 255); border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 3px; width: 100%; box-sizing: border-box; margin-bottom: 16px; display: flex; flex-direction: column; align-items: center; text-align: center; }
.diagram-card h3 { font-size: 16px; margin: 0px 0px 6px; font-weight: 600; color: rgb(36, 41, 46); }
.diagram-card p { font-size: 14px; color: rgb(101, 109, 118); margin: 0px 0px 12px; }
.diagram-canvas { border: 1px solid rgb(208, 215, 222); background: rgb(255, 255, 255); border-radius: 4px; display: block; margin: 0px auto; }
.table-wrapper { overflow-x: auto; margin-bottom: 16px; border: 1px solid rgb(208, 215, 222); border-radius: 6px; box-shadow: rgba(0, 0, 0, 0.1) 0px 2px 4px; width: 850px; min-width: 850px; padding: 20px; box-sizing: border-box; position: relative; }
table { border-collapse: collapse; font-size: 14px; width: 800px; min-width: 800px; background: rgb(255, 255, 255); margin: 0px; table-layout: auto; }
th, td { padding: 8px 12px; text-align: left; border-bottom: 1px solid rgb(208, 215, 222); white-space: normal; overflow-wrap: break-word; max-width: 300px; }
th { position: sticky; top: 0px; z-index: 10; background: rgb(246, 248, 250); font-weight: 600; font-size: 14px; }
td[title] { white-space: normal; overflow-wrap: break-word; max-width: 150px; }
@media (max-width: 768px) {
  .table-wrapper { font-size: 12px; }
  th, td { padding: 6px 8px; max-width: 120px; }
}
tbody tr:hover { background: rgb(246, 248, 250); }
.material-item { display: inline-flex; align-items: center; margin: 4px 6px 4px 0px; padding: 6px 10px; background: rgb(246, 248, 250); border-radius: 4px; border: 1px solid rgb(208, 215, 222); font-size: 14px; }
.material-swatch { width: 16px; height: 16px; border: 1px solid rgb(208, 215, 222); margin-right: 6px; border-radius: 3px; }
.material-name { font-size: 14px; font-weight: 500; }
#materialsContainer { margin-bottom: 16px; }
.tabs { display: flex; gap: 4px; background: rgb(246, 248, 250); padding: 4px; border-radius: 6px; }
.tab-button { background: transparent; border: none; padding: 8px 16px; border-radius: 4px; font-size: 14px; color: rgb(101, 109, 118); cursor: pointer; }
.tab-button.active { background: rgb(255, 255, 255); color: rgb(36, 41, 46); box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 3px; }
.tab-button:disabled { opacity: 0.5; cursor: not-allowed; }
.tab-content { display: none; flex: 1 1 0%; overflow: hidden; }
.tab-content.active { display: flex; flex-direction: column; }
.report-title { text-align: center; margin-bottom: 24px; padding-bottom: 12px; border-bottom: 1px solid rgb(208, 215, 222); }
.report-title h1 { margin: 0px; font-size: 20px; font-weight: 600; color: rgb(36, 41, 46); }
.project-info { background: rgb(246, 248, 250); padding: 16px; border-radius: 6px; border: 1px solid rgb(208, 215, 222); margin: 16px 0px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
.project-field { display: flex; flex-direction: column; }
.project-field label { font-size: 14px; font-weight: 500; margin-bottom: 6px; color: rgb(36, 41, 46); }
.project-field input { padding: 8px 12px; border: 1px solid rgb(208, 215, 222); border-radius: 6px; font-size: 14px; }
.project-field input:focus { outline: none; border-color: rgb(36, 41, 46); box-shadow: rgba(36, 41, 46, 0.1) 0px 0px 0px 3px; }
.project-value { padding: 8px 12px; background: rgb(246, 248, 250); border: 1px solid rgb(208, 215, 222); border-radius: 6px; font-size: 14px; color: rgb(36, 41, 46); font-weight: 500; }
.total-highlight { font-weight: 600; color: rgb(34, 134, 58); background: rgb(246, 255, 237) !important; }
.material-price { font-size: 12px; color: rgb(101, 109, 118); margin-left: 8px; }
.report-header { background: rgb(255, 255, 255); border-bottom: 1px solid rgb(208, 215, 222); padding: 12px 20px; display: flex; justify-content: flex-end; gap: 12px; align-items: center; }
.icon-export-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); padding: 8px 10px; border-radius: 6px; font-size: 12px; color: rgb(36, 41, 46); cursor: pointer; min-width: 60px; }
.icon-export-btn:hover { background: rgb(246, 248, 250); border-color: rgb(140, 149, 159); }
.export-icon { width: 16px; height: 16px; }
.export-label { font-size: 11px; font-weight: 500; }
.materials-controls-group { display: flex; flex-direction: column; gap: 12px; margin-bottom: 16px; }
.materials-action-buttons, .materials-filter-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
.material-icon-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); padding: 8px 10px; border-radius: 6px; font-size: 12px; color: rgb(36, 41, 46); cursor: pointer; min-width: 60px; }
.material-icon-btn:hover { background: rgb(246, 248, 250); border-color: rgb(140, 149, 159); }
.material-icon { width: 16px; height: 16px; }
.materials-sort-controls { display: flex; gap: 8px; align-items: center; }
.sort-select { padding: 6px 8px; border: 1px solid rgb(208, 215, 222); border-radius: 4px; font-size: 14px; background: rgb(255, 255, 255); }
.tree-controls { margin: 12px 0px; }
.tree-search { display: flex; gap: 8px; align-items: center; padding: 12px; background: rgb(246, 248, 250); border-radius: 6px; border: 1px solid rgb(208, 215, 222); }
.tree-search input { flex: 1 1 0%; padding: 6px 10px; border: 1px solid rgb(208, 215, 222); border-radius: 4px; font-size: 14px; }
.tree-search button { padding: 6px 12px; font-size: 14px; background: rgb(101, 109, 118); color: white; border: none; border-radius: 4px; }
.tree-search button:hover { background: rgb(76, 85, 97); }
.tree-structure { background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); border-radius: 6px; padding: 16px; margin: 12px 0px; max-height: 500px; overflow-y: auto; font-size: 14px; }
.tree-header { font-weight: 600; font-size: 16px; color: rgb(36, 41, 46); margin-bottom: 12px; padding-bottom: 6px; border-bottom: 1px solid rgb(208, 215, 222); }
.tree-node { margin: 2px 0px; }
.tree-item { padding: 4px 8px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 14px; }
.tree-expandable:hover { background: rgb(246, 248, 250); }
.expand-icon { width: 12px; text-align: center; font-size: 10px; color: rgb(101, 109, 118); }
.node-name { font-weight: 500; color: rgb(36, 41, 46); }
.node-dimensions { color: rgb(36, 41, 46); font-size: 13px; }
.node-material { color: rgb(101, 109, 118); font-size: 13px; font-style: italic; }
.tree-children { border-left: 1px dotted rgb(208, 215, 222); margin-left: 12px; }
.part-id-btn { background: rgb(246, 248, 250); border: 1px solid rgb(208, 215, 222); padding: 4px 8px; border-radius: 4px; font-size: 12px; color: rgb(36, 41, 46); cursor: pointer; font-weight: 500; transition: 0.15s; }
.part-id-btn:hover { background: rgb(225, 232, 237); border-color: rgb(140, 149, 159); transform: translateY(-1px); }
.part-label-cell:hover, .part-dimensions-cell:hover { font-weight: 600; background: rgb(246, 248, 250) !important; }
.modal { display: none; position: fixed; z-index: 1000; left: 0px; top: 0px; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); overflow-y: auto; }
.modal-content { background: rgb(255, 255, 255); margin: 2vh auto; padding: 20px; border: 1px solid rgb(208, 215, 222); width: 520px; max-width: 90vw; max-height: 96vh; border-radius: 6px; position: relative; top: 50%; transform: translateY(-50%); overflow-y: auto; }
.close { color: rgb(101, 109, 118); float: right; font-size: 24px; font-weight: bold; cursor: pointer; }
.close:hover { color: rgb(36, 41, 46); }
#modalCanvas { border: 1px solid rgb(208, 215, 222); margin: 12px 0px; border-radius: 4px; }
#modalInfo { text-align: left; margin-top: 12px; }
#modalInfo h3 { margin-top: 0px; font-size: 16px; color: rgb(36, 41, 46); }
#modalInfo p { margin: 6px 0px; font-size: 14px; color: rgb(101, 109, 118); }
.modal-controls { text-align: center; margin-bottom: 12px; }
.modal-controls button { margin: 0px 6px; padding: 8px 12px; font-size: 14px; }
.preview-modal-content { width: 85% !important; max-width: 900px !important; max-height: 85vh !important; display: flex !important; flex-direction: column !important; }
.preview-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 12px; border-bottom: 1px solid rgb(208, 215, 222); margin-bottom: 12px; }
.preview-header h2 { margin: 0px; font-size: 18px; font-weight: 600; }
.preview-content { flex: 1 1 0%; overflow-y: auto; padding: 16px; background: rgb(246, 248, 250); border-radius: 6px; margin-bottom: 12px; }
.preview-footer { display: flex; gap: 12px; justify-content: flex-end; padding-top: 12px; border-top: 1px solid rgb(208, 215, 222); }
.btn-primary { background: rgb(34, 134, 58); color: white; border: none; padding: 10px 16px; border-radius: 6px; font-size: 14px; }
.btn-primary:hover { background: rgb(26, 111, 50); }
.copy-btn { background: transparent; border: none; padding: 4px; margin-left: 8px; cursor: pointer; border-radius: 4px; display: inline-flex; align-items: center; justify-content: center; transition: 0.15s; vertical-align: middle; }
.copy-btn:hover { background: rgb(246, 248, 250); }
.copy-btn svg { width: 14px; height: 14px; stroke: rgb(101, 109, 118); }
.copy-btn:hover svg { stroke: rgb(36, 41, 46); }
h2 { display: flex; align-items: center; font-size: 20px; font-weight: 700; color: rgb(36, 41, 46); margin: 40px 0px 20px; padding: 12px 16px; background: rgb(246, 248, 250); border-width: 1px 1px 1px 4px; border-style: solid; border-color: rgb(208, 215, 222) rgb(208, 215, 222) rgb(208, 215, 222) rgb(36, 41, 46); border-image: initial; border-radius: 6px; width: 850px; min-width: 850px; box-sizing: border-box; }
.export-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); padding: 8px 10px; border-radius: 6px; font-size: 12px; color: rgb(36, 41, 46); cursor: pointer; min-width: 60px; transition: 0.15s; }
.export-btn:hover { background: rgb(246, 248, 250); border-color: rgb(140, 149, 159); }
.material-actions button { background: rgb(255, 255, 255) !important; border: 1px solid rgb(208, 215, 222) !important; }
.material-actions button:hover { background: rgb(246, 248, 250) !important; border-color: rgb(140, 149, 159) !important; }
.cost-analysis { background: rgb(246, 248, 250); border-width: 1px 1px 1px 4px; border-style: solid; border-color: rgb(208, 215, 222) rgb(208, 215, 222) rgb(208, 215, 222) rgb(34, 134, 58); border-image: initial; border-radius: 6px; padding: 12px 16px; margin: 16px 0px 32px; font-size: 14px; color: rgb(101, 109, 118); }
#costBreakdownTable { width: auto !important; min-width: auto !important; }
#costBreakdownTable * { width: auto !important; min-width: auto !important; }
.cost-breakdown-container { display: flex; flex-direction: column; gap: 12px; padding: 16px; background: rgb(246, 248, 250); border: 1px solid rgb(208, 215, 222); border-radius: 6px; margin-bottom: 16px; }
.cost-item { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr 2fr; gap: 12px; align-items: center; padding: 8px; background: rgb(255, 255, 255); border-radius: 4px; border: 1px solid rgb(208, 215, 222); }
.cost-material { font-weight: 600; color: rgb(36, 41, 46); }
.cost-count { color: rgb(34, 134, 58); font-weight: 600; }
.cost-amount { font-weight: 600; color: rgb(36, 41, 46); }
.cost-percentage { color: rgb(101, 109, 118); }
.cost-bar { background: rgb(240, 240, 240); border-radius: 3px; height: 20px; min-width: 100px; }
.cost-total { font-weight: bold; font-size: 16px; color: rgb(34, 134, 58); text-align: center; padding: 12px; background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); border-radius: 6px; margin-top: 8px; }
.table-section { margin-bottom: 48px; padding: 20px; background: rgb(255, 255, 255); border: 1px solid rgb(208, 215, 222); border-radius: 8px; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 3px; }
.table-section h2 { margin-top: 0px; margin-bottom: 16px; }
table { margin-bottom: 32px; }
.table-wrapper { margin-bottom: 32px; box-shadow: rgba(0, 0, 0, 0.1) 0px 2px 4px; }
.diagram-canvas { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
.diagram-text-label { font-weight: 500; text-shadow: rgba(0, 0, 0, 0.3) 1px 1px 2px; letter-spacing: 0.5px; }
.diagram-text-dimension { font-weight: 400; text-shadow: rgba(0, 0, 0, 0.2) 1px 1px 2px; font-size: 11px; }
#settingsModal .modal-content { width: 400px; max-width: 90vw; padding: 16px; }
.settings-section { margin-bottom: 16px; }
.settings-section h3 { margin: 0px 0px 12px; font-size: 16px; font-weight: 600; color: rgb(36, 41, 46); padding-bottom: 6px; border-bottom: 1px solid rgb(208, 215, 222); }
.settings-field { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.settings-field label { font-size: 14px; font-weight: 500; color: rgb(36, 41, 46); margin-bottom: 0px; }
.settings-field select { padding: 6px 8px; border: 1px solid rgb(208, 215, 222); border-radius: 4px; font-size: 14px; background: rgb(255, 255, 255); min-width: 120px; }
.settings-buttons { display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px; padding-top: 16px; border-top: 1px solid rgb(208, 215, 222); }
.settings-buttons button { padding: 8px 16px; font-size: 14px; }
.diagram-card { padding-left: 0px; padding-right: 0px; }
.diagram-canvas.ai-style-change-1, .diagram-canvas { margin-left: 0px; margin-right: 0px; width: calc(100% - 24px); display: block; }
.material-icon-btn .material-icon, .icon-export-btn .export-icon, .material-actions button svg, .material-actions button img, #materials_list .material-actions button svg, #materials_list .material-actions button img { filter: brightness(0) saturate(100%) invert(20%) sepia(8%) saturate(1000%) hue-rotate(180deg) brightness(95%) contrast(90%) !important; }
h2, .tree-header, .report-title h1 { font-size: 18px !important; }
.preview-header h2 { font-size: 20px !important; }
@media print {
  .tree-controls, .tree-structure { display: none !important; }
}
.tree-controls, .tree-structure { display: none !important; }
h2:nth-of-type(4) { display: none !important; }
.export-hidden { display: none !important; }
@media print {
  .header, .tabs, button, .resizer, .report-header { display: none !important; }
  body { font-size: 11pt; background: white; }
  .container { display: block; }
  .diagrams-container, .report-container { display: block; width: 100%; padding: 0px; }
  .diagram-card { break-inside: avoid; margin-bottom: 15pt; }
  table { font-size: 9pt; }
  h2 { font-size: 14pt; break-after: avoid; }
}
.cost-summary-box { padding: 12px 16px; background: rgb(246, 248, 250); border-width: 1px 1px 1px 4px; border-style: solid; border-color: rgb(208, 215, 222) rgb(208, 215, 222) rgb(208, 215, 222) rgb(34, 134, 58); border-image: initial; border-radius: 6px; font-size: 14px; color: rgb(101, 109, 118); width: 600px; margin-bottom: 16px; }
.cost-line { margin: 4px 0px; }
.cost-total-line { font-weight: bold; color: rgb(34, 134, 58); margin-top: 8px; padding-top: 8px; border-top: 1px solid rgb(208, 215, 222); }
.cost-breakdown-wrapper { display: block !important; width: auto !important; min-width: auto !important; max-width: 600px !important; margin: 0px 0px 32px !important; padding: 0px !important; border: none !important; box-shadow: none !important; overflow: visible !important; position: static !important; float: none !important; clear: both !important; }
.cost-breakdown-wrapper * { width: auto !important; min-width: auto !important; max-width: none !important; table-layout: auto !important; border-collapse: separate !important; position: static !important; float: none !important; clear: none !important; }
.cost-breakdown-independent { display: block !important; padding: 16px !important; background: rgb(246, 248, 250) !important; border-width: 1px 1px 1px 4px !important; border-style: solid !important; border-color: rgb(208, 215, 222) rgb(208, 215, 222) rgb(208, 215, 222) rgb(34, 134, 58) !important; border-image: initial !important; border-radius: 6px !important; font-size: 14px !important; color: rgb(101, 109, 118) !important; width: auto !important; max-width: 600px !important; margin: 0px !important; box-sizing: border-box !important; }
.cost-line-independent { display: block !important; margin: 6px 0px !important; padding: 0px !important; line-height: 1.4 !important; font-size: 14px !important; color: rgb(101, 109, 118) !important; width: auto !important; }
.cost-total-independent { display: block !important; font-weight: bold !important; color: rgb(34, 134, 58) !important; margin-top: 12px !important; padding-top: 12px !important; border-top: 1px solid rgb(208, 215, 222) !important; font-size: 16px !important; line-height: 1.4 !important; width: auto !important; }
#resizer { width: 8px; background: rgb(208, 215, 222); cursor: col-resize; user-select: none; flex-shrink: 0; transition: background 0.2s; border-left: 1px solid rgb(208, 215, 222); border-right: 1px solid rgb(208, 215, 222); min-height: 100%; }
#resizer:hover { background: rgb(140, 149, 159); }
#resizer:active { background: rgb(101, 109, 118); }
.container { display: flex; flex: 1 1 0%; overflow: hidden; min-height: 0px; }
.diagrams-container { flex: 1 1 0%; min-width: 300px; padding: 16px; background: rgb(255, 255, 255); overflow-y: auto; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 16px; }
.report-container { flex: 1 1 0%; min-width: 400px; padding: 20px 30px 20px 20px; background: rgb(255, 255, 255); overflow-y: auto; box-sizing: border-box; }
.currency-conversion { display: flex; flex-direction: column; gap: 10px; padding: 10px; border: 1px solid rgb(221, 221, 221); border-radius: 5px; background: rgb(249, 249, 249); }
.currency-conversion label { font-weight: bold; margin-bottom: 5px; }
.currency-conversion select, .currency-conversion input { padding: 5px; border: 1px solid rgb(204, 204, 204); border-radius: 3px; }
.currency-conversion button { margin-top: 10px; padding: 8px 16px; background: rgb(0, 124, 186); color: white; border: none; border-radius: 3px; cursor: pointer; }
.currency-conversion button:hover { background: rgb(0, 90, 135); }
.icon-btn { padding: 5px; background: rgb(0, 124, 186); color: white; border: none; border-radius: 3px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.icon-btn:hover { background: rgb(0, 90, 135); }
#settingsModal { z-index: 1000; }
#settingsModal .modal-content { z-index: 1001; }</style>
</head>
<body>
    <div class="header">
        <h1>AutoNestCut Interactive Report</h1>
        <button onclick="window.print()">Print / Save as PDF</button>
    </div>
    <div class="container">
        <div id="diagramsContainer" class="diagrams-container"></div>
        <div class="resizer" id="resizer"></div>
        <div id="reportContainer" class="report-container">
            
                <div class="report-title">
                    <h2 data-translate="report_details">Report Details</h2>
                </div>
                
                <div class="project-info">
                    <div class="project-field">
                        <label for="projectName" data-translate="project_name">Project Name:</label>
                        <input type="text" id="projectName" name="projectName" data-translate="enter_project_name" placeholder="Enter project name">
                    </div>
                    <div class="project-field">
                        <label for="projectAddress" data-translate="address">Address:</label>
                        <input type="text" id="projectAddress" name="projectAddress" data-translate="enter_project_address" placeholder="Enter project address">
                    </div>
                    <div class="project-field">
                        <label for="projectDate" data-translate="date">Date:</label>
                        <input type="date" id="projectDate" name="projectDate">
                    </div>
                </div>

                <h2 data-translate="materials_used">Materials Used</h2>
                <div id="materialsContainer">
            <div class="material-item" onclick="scrollToDiagram('Plywood_08_1K')" style="cursor: pointer;">
                <div class="material-swatch" style="background: hsl(84, 45%, 65%)"></div>
                <span class="material-name">Plywood_08_1K</span>
                <span class="material-price">Price: ر.س340.00</span>
            </div>
            </div>

                <h2 data-translate="overall_summary">Overall Summary</h2>
                <table id="summaryTable">
            <tbody><tr><th>Metric</th><th>Value</th></tr>
            <tr><td>Total Parts Instances</td><td>13</td></tr>
            <tr><td>Total Unique Part Types</td><td>13</td></tr>
            <tr><td>Total Boards</td><td>4</td></tr>
            <tr><td>Overall Efficiency</td><td>65%</td></tr>
            <tr><td><strong>Total Project Cost</strong></td><td class="total-highlight"><strong>ر.س1360.00</strong></td></tr>
        </tbody></table>

                <h2 data-translate="unique_part_types">Unique Part Types</h2>
                <table id="uniquePartTypesTable"><tbody><tr><th>Name</th><th style="width: 50px;">W (mm)</th><th style="width: 50px;">H (mm)</th><th style="width: 50px;">Thick (mm)</th><th>Material</th><th>Grain</th><th style="width: 50px;">Total Qty</th><th style="width: 60px;">Total Area (m²)</th></tr>
                    <tr>
                        <td title="Bottom Base Panel">Bottom Base Panel</td>
                        <td>600</td>
                        <td>600</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>any</td>
                        <td class="total-highlight">1</td>
                        <td>0.360</td>
                    </tr>
                
                    <tr>
                        <td title="Divider Panel">Divider Panel</td>
                        <td>550</td>
                        <td>720</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>any</td>
                        <td class="total-highlight">1</td>
                        <td>0.396</td>
                    </tr>
                
                    <tr>
                        <td title="Door Frame Inner">Door Frame Inner</td>
                        <td>100</td>
                        <td>700</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>vertical</td>
                        <td class="total-highlight">1</td>
                        <td>0.070</td>
                    </tr>
                
                    <tr>
                        <td title="Drawer Back">Drawer Back</td>
                        <td>150</td>
                        <td>500</td>
                        <td>12</td>
                        <td>Plywood_08_1K</td>
                        <td>vertical</td>
                        <td class="total-highlight">1</td>
                        <td>0.075</td>
                    </tr>
                
                    <tr>
                        <td title="Drawer Bottom">Drawer Bottom</td>
                        <td>480</td>
                        <td>500</td>
                        <td>8</td>
                        <td>Plywood_08_1K</td>
                        <td>any</td>
                        <td class="total-highlight">1</td>
                        <td>0.240</td>
                    </tr>
                
                    <tr>
                        <td title="Drawer Divider">Drawer Divider</td>
                        <td>100</td>
                        <td>480</td>
                        <td>12</td>
                        <td>Plywood_08_1K</td>
                        <td>vertical</td>
                        <td class="total-highlight">1</td>
                        <td>0.048</td>
                    </tr>
                
                    <tr>
                        <td title="Kickboard Panel">Kickboard Panel</td>
                        <td>100</td>
                        <td>600</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>vertical</td>
                        <td class="total-highlight">1</td>
                        <td>0.060</td>
                    </tr>
                
                    <tr>
                        <td title="Panel Small A">Panel Small A</td>
                        <td>200</td>
                        <td>300</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>any</td>
                        <td class="total-highlight">1</td>
                        <td>0.060</td>
                    </tr>
                
                    <tr>
                        <td title="Panel Small B">Panel Small B</td>
                        <td>250</td>
                        <td>400</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>vertical</td>
                        <td class="total-highlight">1</td>
                        <td>0.100</td>
                    </tr>
                
                    <tr>
                        <td title="Panel Small C">Panel Small C</td>
                        <td>300</td>
                        <td>450</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>any</td>
                        <td class="total-highlight">1</td>
                        <td>0.135</td>
                    </tr>
                
                    <tr>
                        <td title="Shelf 2">Shelf 2</td>
                        <td>550</td>
                        <td>550</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>any</td>
                        <td class="total-highlight">1</td>
                        <td>0.302</td>
                    </tr>
                
                    <tr>
                        <td title="Shelf 3">Shelf 3</td>
                        <td>550</td>
                        <td>550</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>any</td>
                        <td class="total-highlight">1</td>
                        <td>0.302</td>
                    </tr>
                
                    <tr>
                        <td title="Top Cover Panel">Top Cover Panel</td>
                        <td>600</td>
                        <td>600</td>
                        <td>18</td>
                        <td>Plywood_08_1K</td>
                        <td>any</td>
                        <td class="total-highlight">1</td>
                        <td>0.360</td>
                    </tr>
                </tbody></table>

                <h2 data-translate="unique_board_types">Unique Board Types</h2>
                <table id="uniqueBoardTypesTable"><tbody><tr><th>Material</th><th>Dimensions</th><th>Count</th><th>Total Area (m²)</th><th>Price/Sheet</th><th>Total Cost</th></tr>
                    <tr>
                        <td title="Plywood_08_1K">Plywood_08_1K</td>
                        <td>800 × 1200 mm</td>
                        <td class="total-highlight">4</td>
                        <td>3.840</td>
                        <td>ر.س340.00</td>
                        <td class="total-highlight">ر.س1360.00</td>
                    </tr>
                </tbody></table>

                <h2 data-translate="boards_summary">Boards Summary</h2>
                <table id="boardsTable"><tbody><tr><th>Board#</th><th>Material</th><th>Size</th><th>Parts</th><th>Efficiency</th></tr>
                <tr>
                    <td>1</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>800 × 1200 mm</td>
                    <td class="total-highlight">6</td>
                    <td>85%</td>
                </tr>
            
                <tr>
                    <td>2</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>800 × 1200 mm</td>
                    <td class="total-highlight">4</td>
                    <td>83%</td>
                </tr>
            
                <tr>
                    <td>3</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>800 × 1200 mm</td>
                    <td class="total-highlight">2</td>
                    <td>69%</td>
                </tr>
            
                <tr>
                    <td>4</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>800 × 1200 mm</td>
                    <td class="total-highlight">1</td>
                    <td>25%</td>
                </tr>
            </tbody></table>

                <h2 data-translate="parts_placed_detailed">Parts Placed (Detailed)</h2>
                <div class="tree-controls">
                    <button type="button" id="treeToggle" onclick="toggleTreeView()" data-translate="show_tree_structure">Show Tree Structure</button>
                    <div class="tree-search" id="treeSearchContainer" style="display: none;">
                        <input type="text" id="treeSearch" data-translate="search_components" placeholder="Search components..." oninput="filterTree()">
                        <button type="button" onclick="clearTreeSearch()" data-translate="clear">Clear</button>
                        <button type="button" onclick="expandAll()">Expand All</button>
                        <button type="button" onclick="collapseAll()">Collapse All</button>
                    </div>
                </div>
                <div id="treeStructure" class="tree-structure" style="display: none;"></div>
                <table id="partsTable"><div style="margin-bottom: 10px; padding: 8px; background: #f8f9fa; border-left: 3px solid #28a745; font-size: 12px; color: #495057;">
            <strong>Cost Analysis:</strong> Avg: ر.س68.35 | Min: ر.س17.00 | Max: ر.س140.25
        </div><tbody><tr><th>ID</th><th>Name</th><th>Dimensions</th><th>Material</th><th>Board#</th><th>Cost</th><th>Level</th></tr>
                <tr data-part-id="P1" data-board-number="1" data-cost-level="high">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P1', 1)">P1</button></td>
                    <td title="Divider Panel">Divider Panel</td>
                    <td>550 × 720 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>1</td>
                    <td>ر.س140.25</td>
                    <td><span class="cost-indicator" style="background: #ff4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">High</span></td>
                </tr>
            
                <tr data-part-id="P2" data-board-number="1" data-cost-level="low">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P2', 1)">P2</button></td>
                    <td title="Panel Small C">Panel Small C</td>
                    <td>300 × 450 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>1</td>
                    <td>ر.س47.81</td>
                    <td><span class="cost-indicator" style="background: #44aa44; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">Low</span></td>
                </tr>
            
                <tr data-part-id="P3" data-board-number="1" data-cost-level="low">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P3', 1)">P3</button></td>
                    <td title="Panel Small B">Panel Small B</td>
                    <td>250 × 400 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>1</td>
                    <td>ر.س35.42</td>
                    <td><span class="cost-indicator" style="background: #44aa44; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">Low</span></td>
                </tr>
            
                <tr data-part-id="P4" data-board-number="1" data-cost-level="low">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P4', 1)">P4</button></td>
                    <td title="Drawer Back">Drawer Back</td>
                    <td>150 × 500 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>1</td>
                    <td>ر.س26.56</td>
                    <td><span class="cost-indicator" style="background: #44aa44; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">Low</span></td>
                </tr>
            
                <tr data-part-id="P5" data-board-number="1" data-cost-level="low">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P5', 1)">P5</button></td>
                    <td title="Kickboard Panel">Kickboard Panel</td>
                    <td>100 × 600 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>1</td>
                    <td>ر.س21.25</td>
                    <td><span class="cost-indicator" style="background: #44aa44; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">Low</span></td>
                </tr>
            
                <tr data-part-id="P6" data-board-number="1" data-cost-level="low">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P6', 1)">P6</button></td>
                    <td title="Drawer Divider">Drawer Divider</td>
                    <td>100 × 480 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>1</td>
                    <td>ر.س17.00</td>
                    <td><span class="cost-indicator" style="background: #44aa44; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">Low</span></td>
                </tr>
            
                <tr data-part-id="P7" data-board-number="2" data-cost-level="high">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P7', 2)">P7</button></td>
                    <td title="Top Cover Panel">Top Cover Panel</td>
                    <td>600 × 600 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>2</td>
                    <td>ر.س127.50</td>
                    <td><span class="cost-indicator" style="background: #ff4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">High</span></td>
                </tr>
            
                <tr data-part-id="P8" data-board-number="2" data-cost-level="high">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P8', 2)">P8</button></td>
                    <td title="Shelf 2">Shelf 2</td>
                    <td>550 × 550 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>2</td>
                    <td>ر.س107.14</td>
                    <td><span class="cost-indicator" style="background: #ff4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">High</span></td>
                </tr>
            
                <tr data-part-id="P9" data-board-number="2" data-cost-level="low">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P9', 2)">P9</button></td>
                    <td title="Door Frame Inner">Door Frame Inner</td>
                    <td>100 × 700 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>2</td>
                    <td>ر.س24.79</td>
                    <td><span class="cost-indicator" style="background: #44aa44; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">Low</span></td>
                </tr>
            
                <tr data-part-id="P10" data-board-number="2" data-cost-level="low">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P10', 2)">P10</button></td>
                    <td title="Panel Small A">Panel Small A</td>
                    <td>200 × 300 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>2</td>
                    <td>ر.س21.25</td>
                    <td><span class="cost-indicator" style="background: #44aa44; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">Low</span></td>
                </tr>
            
                <tr data-part-id="P11" data-board-number="3" data-cost-level="high">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P11', 3)">P11</button></td>
                    <td title="Bottom Base Panel">Bottom Base Panel</td>
                    <td>600 × 600 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>3</td>
                    <td>ر.س127.50</td>
                    <td><span class="cost-indicator" style="background: #ff4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">High</span></td>
                </tr>
            
                <tr data-part-id="P12" data-board-number="3" data-cost-level="high">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P12', 3)">P12</button></td>
                    <td title="Shelf 3">Shelf 3</td>
                    <td>550 × 550 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>3</td>
                    <td>ر.س107.14</td>
                    <td><span class="cost-indicator" style="background: #ff4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">High</span></td>
                </tr>
            
                <tr data-part-id="P13" data-board-number="4" data-cost-level="high">
                    <td><button class="part-id-btn" onclick="scrollToPieceDiagram('P13', 4)">P13</button></td>
                    <td title="Drawer Bottom">Drawer Bottom</td>
                    <td>480 × 500 mm</td>
                    <td title="Plywood_08_1K">Plywood_08_1K</td>
                    <td>4</td>
                    <td>ر.س85.00</td>
                    <td><span class="cost-indicator" style="background: #ff4444; color: white; padding: 2px 6px; border-radius: 3px; font-size: 11px;">High</span></td>
                </tr>
            </tbody></table>
            
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script>
        const g_boardsData = [{"material":"Plywood_08_1K","stock_width":800,"stock_height":1200,"parts_count":6,"used_area":814000,"waste_area":146000,"waste_percentage":15.21,"efficiency_percentage":84.78999999999999,"parts":[{"name":"Divider Panel","width":550,"height":720,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","area":396000,"x":0,"y":0,"rotated":false,"instance_id":"P1","texture_data":null},{"name":"Panel Small C","width":300,"height":450,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","area":135000,"x":0,"y":730,"rotated":false,"instance_id":"P2","texture_data":null},{"name":"Panel Small B","width":250,"height":400,"thickness":18,"material":"Plywood_08_1K","grain_direction":"vertical","area":100000,"x":310,"y":730,"rotated":false,"instance_id":"P3","texture_data":null},{"name":"Drawer Back","width":150,"height":500,"thickness":12,"material":"Plywood_08_1K","grain_direction":"vertical","area":75000,"x":560,"y":0,"rotated":false,"instance_id":"P4","texture_data":null},{"name":"Kickboard Panel","width":100,"height":600,"thickness":18,"material":"Plywood_08_1K","grain_direction":"vertical","area":60000,"x":570,"y":510,"rotated":false,"instance_id":"P5","texture_data":null},{"name":"Drawer Divider","width":100,"height":480,"thickness":12,"material":"Plywood_08_1K","grain_direction":"vertical","area":48000,"x":680,"y":510,"rotated":false,"instance_id":"P6","texture_data":null}]},{"material":"Plywood_08_1K","stock_width":800,"stock_height":1200,"parts_count":4,"used_area":792500,"waste_area":167500,"waste_percentage":17.45,"efficiency_percentage":82.55,"parts":[{"name":"Top Cover Panel","width":600,"height":600,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","area":360000,"x":0,"y":0,"rotated":false,"instance_id":"P7","texture_data":null},{"name":"Shelf 2","width":550,"height":550,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","area":302500,"x":0,"y":610,"rotated":false,"instance_id":"P8","texture_data":null},{"name":"Door Frame Inner","width":100,"height":700,"thickness":18,"material":"Plywood_08_1K","grain_direction":"vertical","area":70000,"x":610,"y":0,"rotated":false,"instance_id":"P9","texture_data":null},{"name":"Panel Small A","width":200,"height":300,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","area":60000,"x":560,"y":710,"rotated":false,"instance_id":"P10","texture_data":null}]},{"material":"Plywood_08_1K","stock_width":800,"stock_height":1200,"parts_count":2,"used_area":662500,"waste_area":297500,"waste_percentage":30.99,"efficiency_percentage":69.01,"parts":[{"name":"Bottom Base Panel","width":600,"height":600,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","area":360000,"x":0,"y":0,"rotated":false,"instance_id":"P11","texture_data":null},{"name":"Shelf 3","width":550,"height":550,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","area":302500,"x":0,"y":610,"rotated":false,"instance_id":"P12","texture_data":null}]},{"material":"Plywood_08_1K","stock_width":800,"stock_height":1200,"parts_count":1,"used_area":240000,"waste_area":720000,"waste_percentage":75,"efficiency_percentage":25,"parts":[{"name":"Drawer Bottom","width":480,"height":500,"thickness":8,"material":"Plywood_08_1K","grain_direction":"any","area":240000,"x":0,"y":0,"rotated":false,"instance_id":"P13","texture_data":null}]}];
        const g_reportData = {"parts_placed":[{"part_unique_id":"P1","name":"Divider Panel","width":550,"height":720,"thickness":18,"material":"Plywood_08_1K","area":396000,"board_number":1,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"any","units":"mm"},{"part_unique_id":"P2","name":"Panel Small C","width":300,"height":450,"thickness":18,"material":"Plywood_08_1K","area":135000,"board_number":1,"position_x":0,"position_y":730,"rotated":"No","grain_direction":"any","units":"mm"},{"part_unique_id":"P3","name":"Panel Small B","width":250,"height":400,"thickness":18,"material":"Plywood_08_1K","area":100000,"board_number":1,"position_x":310,"position_y":730,"rotated":"No","grain_direction":"vertical","units":"mm"},{"part_unique_id":"P4","name":"Drawer Back","width":150,"height":500,"thickness":12,"material":"Plywood_08_1K","area":75000,"board_number":1,"position_x":560,"position_y":0,"rotated":"No","grain_direction":"vertical","units":"mm"},{"part_unique_id":"P5","name":"Kickboard Panel","width":100,"height":600,"thickness":18,"material":"Plywood_08_1K","area":60000,"board_number":1,"position_x":570,"position_y":510,"rotated":"No","grain_direction":"vertical","units":"mm"},{"part_unique_id":"P6","name":"Drawer Divider","width":100,"height":480,"thickness":12,"material":"Plywood_08_1K","area":48000,"board_number":1,"position_x":680,"position_y":510,"rotated":"No","grain_direction":"vertical","units":"mm"},{"part_unique_id":"P7","name":"Top Cover Panel","width":600,"height":600,"thickness":18,"material":"Plywood_08_1K","area":360000,"board_number":2,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"any","units":"mm"},{"part_unique_id":"P8","name":"Shelf 2","width":550,"height":550,"thickness":18,"material":"Plywood_08_1K","area":302500,"board_number":2,"position_x":0,"position_y":610,"rotated":"No","grain_direction":"any","units":"mm"},{"part_unique_id":"P9","name":"Door Frame Inner","width":100,"height":700,"thickness":18,"material":"Plywood_08_1K","area":70000,"board_number":2,"position_x":610,"position_y":0,"rotated":"No","grain_direction":"vertical","units":"mm"},{"part_unique_id":"P10","name":"Panel Small A","width":200,"height":300,"thickness":18,"material":"Plywood_08_1K","area":60000,"board_number":2,"position_x":560,"position_y":710,"rotated":"No","grain_direction":"any","units":"mm"},{"part_unique_id":"P11","name":"Bottom Base Panel","width":600,"height":600,"thickness":18,"material":"Plywood_08_1K","area":360000,"board_number":3,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"any","units":"mm"},{"part_unique_id":"P12","name":"Shelf 3","width":550,"height":550,"thickness":18,"material":"Plywood_08_1K","area":302500,"board_number":3,"position_x":0,"position_y":610,"rotated":"No","grain_direction":"any","units":"mm"},{"part_unique_id":"P13","name":"Drawer Bottom","width":480,"height":500,"thickness":8,"material":"Plywood_08_1K","area":240000,"board_number":4,"position_x":0,"position_y":0,"rotated":"No","grain_direction":"any","units":"mm"}],"unique_part_types":[{"name":"Bottom Base Panel","width":600,"height":600,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","total_quantity":1,"total_area":360000,"units":"mm"},{"name":"Divider Panel","width":550,"height":720,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","total_quantity":1,"total_area":396000,"units":"mm"},{"name":"Door Frame Inner","width":100,"height":700,"thickness":18,"material":"Plywood_08_1K","grain_direction":"vertical","total_quantity":1,"total_area":70000,"units":"mm"},{"name":"Drawer Back","width":150,"height":500,"thickness":12,"material":"Plywood_08_1K","grain_direction":"vertical","total_quantity":1,"total_area":75000,"units":"mm"},{"name":"Drawer Bottom","width":480,"height":500,"thickness":8,"material":"Plywood_08_1K","grain_direction":"any","total_quantity":1,"total_area":240000,"units":"mm"},{"name":"Drawer Divider","width":100,"height":480,"thickness":12,"material":"Plywood_08_1K","grain_direction":"vertical","total_quantity":1,"total_area":48000,"units":"mm"},{"name":"Kickboard Panel","width":100,"height":600,"thickness":18,"material":"Plywood_08_1K","grain_direction":"vertical","total_quantity":1,"total_area":60000,"units":"mm"},{"name":"Panel Small A","width":200,"height":300,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","total_quantity":1,"total_area":60000,"units":"mm"},{"name":"Panel Small B","width":250,"height":400,"thickness":18,"material":"Plywood_08_1K","grain_direction":"vertical","total_quantity":1,"total_area":100000,"units":"mm"},{"name":"Panel Small C","width":300,"height":450,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","total_quantity":1,"total_area":135000,"units":"mm"},{"name":"Shelf 2","width":550,"height":550,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","total_quantity":1,"total_area":302500,"units":"mm"},{"name":"Shelf 3","width":550,"height":550,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","total_quantity":1,"total_area":302500,"units":"mm"},{"name":"Top Cover Panel","width":600,"height":600,"thickness":18,"material":"Plywood_08_1K","grain_direction":"any","total_quantity":1,"total_area":360000,"units":"mm"}],"unique_board_types":[{"material":"Plywood_08_1K","dimensions_mm":"800.0 x 1200.0 mm","stock_width":800,"stock_height":1200,"count":4,"total_area":3840000,"units":"mm","price_per_sheet":340,"currency":"SAR","total_cost":1360}],"boards":[{"board_number":1,"material":"Plywood_08_1K","stock_size_mm":"800.0 x 1200.0 mm","stock_width":800,"stock_height":1200,"parts_count":6,"used_area":814000,"waste_area":146000,"waste_percentage":15.21,"efficiency":84.78999999999999,"units":"mm","precision":0},{"board_number":2,"material":"Plywood_08_1K","stock_size_mm":"800.0 x 1200.0 mm","stock_width":800,"stock_height":1200,"parts_count":4,"used_area":792500,"waste_area":167500,"waste_percentage":17.45,"efficiency":82.55,"units":"mm","precision":0},{"board_number":3,"material":"Plywood_08_1K","stock_size_mm":"800.0 x 1200.0 mm","stock_width":800,"stock_height":1200,"parts_count":2,"used_area":662500,"waste_area":297500,"waste_percentage":30.99,"efficiency":69.01,"units":"mm","precision":0},{"board_number":4,"material":"Plywood_08_1K","stock_size_mm":"800.0 x 1200.0 mm","stock_width":800,"stock_height":1200,"parts_count":1,"used_area":240000,"waste_area":720000,"waste_percentage":75,"efficiency":25,"units":"mm","precision":0}],"summary":{"total_parts_instances":13,"total_unique_part_types":13,"total_boards":4,"total_stock_area":3840000,"total_used_area":2509000,"total_waste_area":1331000,"overall_waste_percentage":34.66,"overall_efficiency":65.34,"total_project_cost":1360,"currency":"SAR","units":"mm","precision":0}};
        const currentUnits = 'mm';
        const currentPrecision = 0;
        const unitFactors = {"mm":1,"cm":10,"in":25.4,"ft":304.8};
        const currencySymbols = {"USD":"$","EUR":"€","GBP":"£","CAD":"C$","AUD":"A$","JPY":"¥","CNY":"¥","INR":"₹","BRL":"R$","MXN":"$","CHF":"CHF","SEK":"kr","NOK":"kr","DKK":"kr","PLN":"zł","SAR":"ر.س","AED":"د.إ","KWD":"د.ك","QAR":"ر.ق","BHD":"د.ب","OMR":"ر.ع","JOD":"د.ا","LBP":"ل.ل","EGP":"ج.م","TND":"د.ت","MAD":"د.م","DZD":"د.ج","LYD":"ل.د","IQD":"د.ع","SYP":"ل.س","TRY":"₺","IRR":"ریال"};
        
        function formatNumber(value, precision) {
    if (typeof value !== 'number') {
        // Handle cases where value might not be a number gracefully
        console.warn('formatNumber received non-numeric value:', value);
        return String(value); 
    }
    
    // Explicitly check for 0 or string '0' to use Math.round for no decimal places.
    // This correctly renders 800 instead of 800.0 when precision is 0.
    if (precision === 0 || precision === '0' || precision === 0.0) {
        return Math.round(value).toString();
    }
    
    // Ensure precision is a valid non-negative number for toFixed.
    const actualPrecision = typeof precision === 'number' ? precision : parseFloat(precision);
    if (isNaN(actualPrecision) || actualPrecision < 0) {
        console.warn('Invalid precision provided to formatNumber, defaulting to 1 decimal:', precision);
        return value.toFixed(1); // Default to 1 decimal place if precision is invalid
    }
    
    return value.toFixed(actualPrecision);
}
        function getMaterialColor(material) {
    let hash = 0;
    for (let i = 0; i < material.length; i++) {
        hash = material.charCodeAt(i) + ((hash << 5) - hash);
    }
    const hue = Math.abs(hash) % 360;
    return `hsl(${hue}, 45%, 65%)`;
}
        function scrollToDiagram(material) {
    // Sanitize material name for ID matching
    const sanitizedMaterial = material.replace(/[^a-zA-Z0-9]/g, '_');
    const diagrams = document.querySelectorAll(`[id^="diagram-${sanitizedMaterial}-"]`);
    if (diagrams.length > 0) {
        diagrams[0].scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
}
        function scrollToPieceDiagram(partId, boardNumber) {
    // Find the board diagram that contains this piece
    const boardIndex = boardNumber - 1; // Convert to 0-based index
    
    if (boardIndex < 0 || boardIndex >= g_boardsData.length) {
        console.warn(`Board ${boardNumber} not found`);
        return;
    }
    
    const board = g_boardsData[boardIndex];
    const diagramContainer = document.getElementById('diagramsContainer');
    
    if (!diagramContainer) {
        console.warn('Diagrams container not found');
        return;
    }
    
    // Find the canvas for this board
    const diagrams = diagramContainer.querySelectorAll('.diagram-card');
    let targetCanvas = null;
    let targetCard = null;
    
    if (boardIndex < diagrams.length) {
        targetCard = diagrams[boardIndex];
        targetCanvas = targetCard.querySelector('canvas');
    }
    
    if (!targetCanvas) {
        console.warn(`Canvas for board ${boardNumber} not found`);
        return;
    }
    
    // Clear previous highlight
    clearPieceHighlight();
    
    // Find the piece in the canvas data
    if (targetCanvas.partData) {
        for (let partData of targetCanvas.partData) {
            const partLabel = String(partData.part.instance_id || `P${partData.part.index || 0}`);
            if (partLabel === partId) {
                // Highlight this piece on the canvas
                highlightPieceOnCanvas(targetCanvas, partData);
                currentHighlightedPiece = partId;
                currentHighlightedCanvas = targetCanvas;
                break;
            }
        }
    }
    
    // Scroll the diagram card into view
    if (targetCard) {
        targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
}
        function highlightPieceOnCanvas(canvas, partData) {
    // Redraw the canvas with the piece highlighted
    const ctx = canvas.getContext('2d');

    // Store original drawing function if not already stored
    if (!canvas.originalDraw) {
        canvas.originalDraw = canvas.toDataURL();
    }

    // Add a visual highlight by drawing a border around the piece
    ctx.strokeStyle = '#007bff';
    ctx.lineWidth = 3;

    // Draw highlight border
    ctx.strokeRect(
        partData.x - 2,
        partData.y - 2,
        partData.width + 4,
        partData.height + 4
    );
}
        function clearPieceHighlight() {
    if (currentHighlightedCanvas) {
        // Redraw the canvas to remove highlight
        const board = g_boardsData[currentHighlightedCanvas.boardIndex];
        if (board) {
            // Redraw the entire diagram
            redrawCanvasDiagram(currentHighlightedCanvas, board);
        }
        currentHighlightedCanvas = null;
        currentHighlightedPiece = null;
    }
}
        function redrawCanvasDiagram(canvas, board) {
    const ctx = canvas.getContext('2d');
    const padding = 40;
    const maxCanvasDim = 600;
    const scale = Math.min(
        (maxCanvasDim - 2 * padding) / board.stock_width,
        (maxCanvasDim - 2 * padding) / board.stock_height
    );

    canvas.width = board.stock_width * scale + 2 * padding;
    canvas.height = board.stock_height * scale + 2 * padding;

    ctx.fillStyle = '#f5f5f5';
    ctx.fillRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
    ctx.strokeStyle = '#666';
    ctx.lineWidth = 2;
    ctx.strokeRect(padding, padding, board.stock_width * scale, board.stock_height * scale);
    
    ctx.fillStyle = '#333';
    ctx.font = `${Math.max(12, 14 * scale)}px Arial`;
    ctx.textAlign = 'center';
    ctx.fillText(`${board.stock_width.toFixed(0)}mm`, padding + (board.stock_width * scale) / 2, padding - 5);
    
    ctx.save();
    ctx.translate(padding - 15, padding + (board.stock_height * scale) / 2);
    ctx.rotate(-Math.PI / 2);
    ctx.fillText(`${board.stock_height.toFixed(0)}mm`, 0, 0);
    ctx.restore();

    const parts = board.parts || [];
    canvas.partData = [];
    
    parts.forEach((part, partIndex) => {
        const partX = padding + part.x * scale;
        const partY = padding + part.y * scale;
        const partWidth = part.width * scale;
        const partHeight = part.height * scale;

        ctx.fillStyle = getMaterialColor(part.material);
        ctx.fillRect(partX, partY, partWidth, partHeight);
        ctx.strokeStyle = '#333';
        ctx.lineWidth = 1;
        ctx.strokeRect(partX, partY, partWidth, partHeight);

        canvas.partData.push({
            x: partX, y: partY, width: partWidth, height: partHeight,
            part: part, boardIndex: board.index || 0
        });

        if (partWidth > 30 && partHeight > 20) {
            ctx.fillStyle = '#ffffff';
            ctx.font = `bold ${Math.max(12, 14 * scale)}px sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const labelContent = String(part.instance_id || `P${partIndex + 1}`);
            const maxChars = Math.max(6, Math.floor(partWidth / 8));
            const displayLabel = labelContent.length > maxChars ? labelContent.slice(0, maxChars - 1) + '…' : labelContent;
            ctx.fillText(displayLabel, partX + partWidth / 2, partY + partHeight / 2);
        }

        if (partWidth > 50) {
            ctx.fillStyle = '#ffffff';
            ctx.font = `${Math.max(10, 11 * scale)}px sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            ctx.fillText(`${Math.round(part.width)}mm`, partX + partWidth / 2, partY + 5);
        }

        if (partHeight > 50) {
            ctx.save();
            ctx.translate(partX + 5, partY + partHeight / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillStyle = '#ffffff';
            ctx.font = `${Math.max(10, 11 * scale)}px sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'top';
            ctx.fillText(`${Math.round(part.height)}mm`, 0, 0);
            ctx.restore();
        }
    });
}
        function attachPartTableClickHandlers() {
    // No additional styling needed - buttons are styled via CSS
}
        function renderDiagrams() {
    console.log('renderDiagrams called, g_boardsData:', g_boardsData);
    
    const container = document.getElementById('diagramsContainer');
    if (!container) {
        console.error('diagramsContainer element not found');
        return;
    }
    
    container.innerHTML = '';

    if (!g_boardsData || g_boardsData.length === 0) {
        console.log('No boards data available');
        container.innerHTML = '<p>No cutting diagrams to display. Please generate a cut list first.</p>';
        return;
    }
    
    console.log('Rendering', g_boardsData.length, 'diagrams');

    g_boardsData.forEach((board, boardIndex) => {
        console.log('Rendering board', boardIndex, ':', board);
        const card = document.createElement('div');
        card.className = 'diagram-card';

        const title = document.createElement('h3');
        title.textContent = `${board.material} Board ${boardIndex + 1}`;
        title.id = `diagram-${board.material.replace(/[^a-zA-Z0-9]/g, '_')}-${boardIndex}`;
        card.appendChild(title);

        const info = document.createElement('p');
        const units = currentUnits || 'mm';
        // FIX: Use nullish coalescing operator (??) to correctly handle currentPrecision being 0
        const precision = currentPrecision ?? 1; 
        
        const width = board.stock_width / unitFactors[units];
        const height = board.stock_height / unitFactors[units];
        
        // Use the global formatNumber function for board dimensions in the info section
        info.innerHTML = `Size: ${formatNumber(width, precision)}x${formatNumber(height, precision)}${units}<br>
                          Waste: ${board.waste_percentage.toFixed(1)}% (Efficiency: ${board.efficiency_percentage.toFixed(1)}%)`;
        card.appendChild(info);

        const canvas = document.createElement('canvas');
        canvas.className = 'diagram-canvas';
        card.appendChild(canvas);

        container.appendChild(card);

        function drawCanvas() {
            const containerWidth = card.offsetWidth - 24;
            const ctx = canvas.getContext('2d');
            const padding = 40;
            const maxCanvasDim = Math.min(containerWidth, 600);
            
            const boardWidth = parseFloat(board.stock_width) || 1000;
            const boardHeight = parseFloat(board.stock_height) || 1000;
            
            const scale = Math.min(
                (maxCanvasDim - 2 * padding) / boardWidth,
                (maxCanvasDim - 2 * padding) / boardHeight
            );

            canvas.width = boardWidth * scale + 2 * padding;
            canvas.height = boardHeight * scale + 2 * padding;

        ctx.fillStyle = '#f5f5f5';
        ctx.fillRect(padding, padding, boardWidth * scale, boardHeight * scale);
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 2;
        ctx.strokeRect(padding, padding, boardWidth * scale, boardHeight * scale);
        
        ctx.fillStyle = '#333';
        ctx.font = `${Math.max(12, 14 * scale)}px Arial`;
        ctx.textAlign = 'center';
        const reportUnits = currentUnits || 'mm';
        const displayWidth = boardWidth / unitFactors[reportUnits];
        // FIX: Use formatNumber for canvas board dimensions for consistency
        ctx.fillText(`${formatNumber(displayWidth, 0)}${reportUnits}`, padding + (boardWidth * scale) / 2, padding - 5);
        
        ctx.save();
        ctx.translate(padding - 15, padding + (boardHeight * scale) / 2);
        ctx.rotate(-Math.PI / 2);
        const displayHeight = boardHeight / unitFactors[reportUnits];
        // FIX: Use formatNumber for canvas board dimensions for consistency
        ctx.fillText(`${formatNumber(displayHeight, 0)}${reportUnits}`, 0, 0);
        ctx.restore();

        const parts = board.parts || [];
        console.log('Board', boardIndex, 'has', parts.length, 'parts');
        canvas.boardIndex = boardIndex;
        canvas.boardData = board;
        canvas.partData = [];
        
        parts.forEach((part, partIndex) => {
            console.log('Rendering part', partIndex, ':', part);
            // Ensure part dimensions and positions are valid numbers
            const partPosX = parseFloat(part.x) || 0;
            const partPosY = parseFloat(part.y) || 0;
            const partW = parseFloat(part.width) || 10;
            const partH = parseFloat(part.height) || 10;
            
            const partX = padding + partPosX * scale;
            const partY = padding + partPosY * scale;
            const partWidth = partW * scale;
            const partHeight = partH * scale;

            ctx.fillStyle = getMaterialColor(part.material);
            ctx.fillRect(partX, partY, partWidth, partHeight);
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 0.5;
            ctx.strokeRect(partX, partY, partWidth, partHeight);

            canvas.partData.push({
                x: partX, y: partY, width: partWidth, height: partHeight,
                part: part, boardIndex: boardIndex
            });

            if (partWidth > 30 && partHeight > 20) {
                ctx.fillStyle = '#ffffff';
                ctx.font = `bold ${Math.max(12, 14 * scale)}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                const labelContent = String(part.instance_id || `P${partIndex + 1}`);
                const maxChars = Math.max(6, Math.floor(partWidth / 8));
                const displayLabel = labelContent.length > maxChars ? labelContent.slice(0, maxChars - 1) + '…' : labelContent;
                ctx.fillText(displayLabel, partX + partWidth / 2, partY + partHeight / 2);
            }

            if (partWidth > 50) {
                ctx.fillStyle = '#ffffff';
                ctx.font = `${Math.max(10, 11 * scale)}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                const partDisplayW = partW / unitFactors[reportUnits];
                ctx.fillText(`${Math.round(partDisplayW)}${reportUnits}`, partX + partWidth / 2, partY + 5); 
            }

            if (partHeight > 50) {
                ctx.save();
                ctx.translate(partX + 5, partY + partHeight / 2);
                ctx.rotate(-Math.PI / 2);
                ctx.fillStyle = '#ffffff';
                ctx.font = `${Math.max(10, 11 * scale)}px sans-serif`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'top';
                const partDisplayH = partH / unitFactors[reportUnits];
                ctx.fillText(`${Math.round(partDisplayH)}${reportUnits}`, 0, 0); 
                ctx.restore();
            }
        });

            canvas.addEventListener('click', (e) => handleCanvasClick(e, canvas));
            canvas.addEventListener('mousemove', (e) => handleCanvasHover(e, canvas));
            canvas.style.cursor = 'pointer';
        }
        
        drawCanvas();
        
        const resizeObserver = new ResizeObserver(() => {
            drawCanvas();
        });
        resizeObserver.observe(card);
    });
    
    console.log('Finished rendering diagrams');
}
        function initResizer() {
    const resizer = document.getElementById('resizer');
    const leftSide = document.getElementById('diagramsContainer');
    const rightSide = document.getElementById('reportContainer');
    
    if (!resizer || !leftSide || !rightSide) return;
    
    let isResizing = false;
    
    resizer.addEventListener('mousedown', (e) => {
        isResizing = true;
        document.body.style.cursor = 'col-resize';
        document.body.style.userSelect = 'none';
        e.preventDefault();
    });
    
    document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;
        
        const container = document.querySelector('.container');
        const containerRect = container.getBoundingClientRect();
        const newLeftWidth = e.clientX - containerRect.left;
        const totalWidth = containerRect.width;
        
        if (newLeftWidth > 300 && totalWidth - newLeftWidth > 400) {
            leftSide.style.flex = `0 0 ${newLeftWidth}px`;
            rightSide.style.flex = `1 1 auto`;
        }
    });
    
    document.addEventListener('mouseup', () => {
        if (isResizing) {
            isResizing = false;
            document.body.style.cursor = '';
            document.body.style.userSelect = '';
        }
    });
}
        
        let currentHighlightedPiece = null;
        let currentHighlightedCanvas = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            renderDiagrams();
            initResizer();
        });
    </script>
</body>
</html>